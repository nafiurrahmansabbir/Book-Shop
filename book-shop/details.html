<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Book Details with Side Cart Drawer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.24/dist/full.min.css" rel="stylesheet" />
  <style>
    /* Side drawer styles */
    #cart-drawer {
      transition: transform 0.3s ease;
      transform: translateX(100%);
      width: 320px;
      max-width: 80vw;
      position: fixed;
      top: 0;
      right: 0;
      height: 100vh;
      background: white;
      box-shadow: -4px 0 12px rgba(0,0,0,0.1);
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }
    #cart-drawer.open {
      transform: translateX(0);
    }
  </style>
</head>
<body class="bg-gray-100">

  <!-- Floating Cart Counter -->
  <div class="fixed top-4 right-4 bg-white rounded-full shadow-md px-3 py-1 flex items-center gap-2 z-50 cursor-pointer" onclick="openCartDrawer()">
    <img src="https://cdn-icons-png.flaticon.com/512/263/263142.png" class="w-5 h-5" alt="Cart" />
    <span id="cart-count" class="font-bold text-blue-600">0</span>
  </div>

  <!-- Nav-Bar Section -->
<nav class="bg-white shadow-md">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16 items-center">
      <!-- Logo -->
      <div class="flex items-center">
        <span class="text-2xl font-bold text-blue-600">ðŸ“š BookNest</span>
      </div>

      <!-- Navigation Links -->
      <div class="hidden md:flex space-x-8">
        <a href="index.html" class="text-gray-700 hover:text-blue-600 font-medium">Home</a>
        <a href="allmanga.html" class="text-gray-700 hover:text-blue-600 font-medium">Shop</a>
        <a href="categories.html" class="text-gray-700 hover:text-blue-600 font-medium">Categories</a>
        <a href="blog.html" class="text-gray-700 hover:text-blue-600 font-medium">Blog</a>
        <a href="about.html" class="text-gray-700 hover:text-blue-600 font-medium">About</a>
        <a href="contact.html" class="text-gray-700 hover:text-blue-600 font-medium">Contact</a>
      </div>

      <!-- Login Button -->
      <div class="hidden md:block">
        <a href="login.html" class="text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md font-medium">Login</a>
      </div>
      
    </div>
  </div>
</nav>
  <!-- end nav -->

  <!-- Product Detail / Book Card -->
  <section class="bg-white py-16 py-10">
    <div class="max-w-6xl mx-auto px-4 lg:px-8 flex flex-col md:flex-row gap-12" id="detailsContainer">
      <p class="text-center w-full text-gray-500">Loading...</p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer bg-base-300 text-base-content p-10">
    <nav>
      <h6 class="footer-title">Services</h6>
      <a class="link link-hover">Branding</a>
      <a class="link link-hover">Design</a>
      <a class="link link-hover">Marketing</a>
      <a class="link link-hover">Advertisement</a>
    </nav>
    <nav>
      <h6 class="footer-title">Company</h6>
      <a class="link link-hover">About us</a>
      <a class="link link-hover">Contact</a>
      <a class="link link-hover">Jobs</a>
      <a class="link link-hover">Press kit</a>
    </nav>
    <nav>
      <h6 class="footer-title">Social</h6>
      <div class="grid grid-flow-col gap-4">
        <!-- Social icons here -->
      </div>
    </nav>
  </footer>

  <!-- Side Cart Drawer -->
  <aside id="cart-drawer" aria-label="Shopping cart">
    <div class="flex items-center justify-between p-4 border-b border-gray-200">
      <h2 class="text-xl font-bold">Your Cart</h2>
      <button aria-label="Close cart" onclick="closeCartDrawer()" class="text-gray-600 hover:text-gray-900 text-2xl font-bold">Ã—</button>
    </div>
    <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-4">
      <!-- Cart items will be rendered here -->
      <p class="text-gray-500">Cart is empty.</p>
    </div>
    <div class="p-4 border-t border-gray-200">
      <button onclick="checkout()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded">
        Checkout
      </button>
    </div>
  </aside>

  <!-- Quantity Buttons Script -->
  <script>
    const decr = () => {
      let v = parseInt(document.getElementById('qty-input').value, 10);
      if (v > 1) document.getElementById('qty-input').value = v - 1;
    };
    const incr = () => {
      let v = parseInt(document.getElementById('qty-input').value, 10);
      document.getElementById('qty-input').value = v + 1;
    };
  </script>

  <!-- Dynamic Book Detail Loader -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    fetch('./public/allbooks.json')
      .then(res => res.json())
      .then(data => {
        const book = data.find(b => b.id === id);

        if (!book) {
          document.getElementById('detailsContainer').innerHTML = '<p class="text-red-500">Manga not found.</p>';
          return;
        }

        document.getElementById('detailsContainer').innerHTML = `
          <div class="md:w-1/2 flex flex-col items-center">
            <img src="${book.image}" alt="${book.title}" class="w-full max-w-xs rounded shadow-md" />
            <div class="mt-6 flex space-x-3">
              <span class="w-3 h-3 rounded-full border-2 border-gray-900"></span>
              <span class="w-3 h-3 rounded-full bg-gray-300"></span>
            </div>
          </div>

          <div class="md:flex-1 md:pt-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-4">${book.title}</h1>
            <p class="text-sm text-gray-600 mb-6">
              <span class="font-medium">By (author)</span>
              <span class="ml-1 text-gray-800">${book.author}</span>
            </p>
            <p class="text-2xl font-semibold text-gray-900 mb-6">${book.price}</p>
            <p class="text-gray-700 leading-relaxed mb-8 max-w-prose">${book.description}</p>

            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-4 mb-8">
              <div class="flex items-center border border-gray-300 rounded">
                <button onclick="decr()" class="px-4 py-3 text-xl font-semibold hover:bg-gray-50 select-none">âˆ’</button>
                <input id="qty-input" type="text" value="1" readonly class="w-12 text-center bg-transparent text-lg focus:outline-none" />
                <button onclick="incr()" class="px-4 py-3 text-xl font-semibold hover:bg-gray-50 select-none">+</button>
              </div>
              <button onclick="addToCart()" class="flex-1 inline-flex justify-center items-center bg-gray-900 hover:bg-gray-800 text-white font-medium rounded px-8 py-4 transition">
                Add to cart ðŸ›’
              </button>
            </div>
          </div>
        `;
      })
      .catch(err => {
        document.getElementById('detailsContainer').innerHTML = '<p class="text-red-500">Error loading data.</p>';
        console.error(err);
      });
  </script>

  <!-- Cart Drawer & Add to Cart Logic -->
  <script>
    let cart = JSON.parse(localStorage.getItem("cart")) || {};

    // Update cart count badge
    function updateCartCount() {
      const totalCount = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById("cart-count").textContent = totalCount;
    }

    // Render items inside the drawer
    function renderCartItems() {
      const container = document.getElementById("cart-items");
      container.innerHTML = "";

      if (Object.keys(cart).length === 0) {
        container.innerHTML = '<p class="text-gray-500">Cart is empty.</p>';
        return;
      }

      for (const [bookId, item] of Object.entries(cart)) {
        const itemEl = document.createElement("div");
        itemEl.className = "flex items-center justify-between border rounded p-3";

        itemEl.innerHTML = `
          <div class="flex items-center space-x-3 max-w-xs">
            <img src="${item.image}" alt="${item.title}" class="w-16 h-20 object-cover rounded" />
            <div>
              <h3 class="font-semibold text-gray-900">${item.title}</h3>
              <p class="text-sm text-gray-600">${item.author}</p>
              <p class="text-sm font-semibold mt-1">${item.price}</p>
            </div>
          </div>
          <div class="flex items-center space-x-2">
            <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300" onclick="changeQuantity('${bookId}', -1)">âˆ’</button>
            <span class="w-6 text-center">${item.quantity}</span>
            <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300" onclick="changeQuantity('${bookId}', 1)">+</button>
          </div>
        `;

        container.appendChild(itemEl);
      }
    }

    // Change quantity of a cart item
    function changeQuantity(bookId, delta) {
      if (!cart[bookId]) return;
      cart[bookId].quantity += delta;
      if (cart[bookId].quantity < 1) {
        delete cart[bookId];
      }
      saveCart();
      renderCartItems();
      updateCartCount();
    }

    // Save cart to localStorage
    function saveCart() {
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    // Add current book to cart
    function addToCart() {
      const qtyInput = document.getElementById("qty-input");
      const quantity = qtyInput ? parseInt(qtyInput.value) || 1 : 1;

      const bookId = new URLSearchParams(window.location.search).get("id");
      if (!bookId) return alert("Book ID missing.");

      fetch('./public/allbooks.json')
        .then(res => res.json())
        .then(data => {
          const book = data.find(b => b.id === bookId);
          if (!book) return alert("Book not found.");

          if (cart[bookId]) {
            cart[bookId].quantity += quantity;
          } else {
            cart[bookId] = {
              ...book,
              quantity: quantity
            };
          }
          saveCart();
          updateCartCount();
          renderCartItems();
          openCartDrawer();
        });
    }

    // Open drawer
    function openCartDrawer() {
      document.getElementById("cart-drawer").classList.add("open");
      renderCartItems();
    }

    // Close drawer
    function closeCartDrawer() {
      document.getElementById("cart-drawer").classList.remove("open");
    }

    // Checkout placeholder
    function checkout() {
      alert("Proceeding to checkout with " + Object.values(cart).reduce((sum, i) => sum + i.quantity, 0) + " items.");
    }

    // Initialize cart count on page load
    updateCartCount();
  </script>

</body>
</html>
